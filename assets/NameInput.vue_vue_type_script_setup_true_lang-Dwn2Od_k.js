import{c as $,r as N,p as Y,B as Z,C as ee,o as te,h as B,b as W,g as z,at as ae,x as F,e as ne,au as oe,av as se,a as E,K as le,aw as re,L as ie,ax as ue,u as H,m as ce,a6 as de,ay as fe,az as me,ak as ve,aA as pe,_ as ye,aB as he,aC as P,as as g,P as be,aD as ge,N as G,aq as J,w as ke,O as S,S as I,T as k,X as C,al as X,U as _,aE as we,aF as Q,aG as K,V as T,W as A,a0 as V,Y as j,a4 as xe,s as U,an as M,ao as qe,aH as _e,aI as Se,Q as Ce,a1 as Ne,R as Ee}from"./index-DUrGJN2_.js";import{a as Ve,Q as Be}from"./QIntersection-Cp4GYU95.js";import{u as Pe}from"./useNotify-BsPaTxiY.js";import{u as L}from"./vue-i18n-oM_WjuWh.js";const je=$({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:n}){const p=z(),l=N(null);let r=0;const y=[];function w(t){const o=typeof t=="boolean"?t:e.noErrorFocus!==!0,i=++r,c=(a,f)=>{n(`validation${a===!0?"Success":"Error"}`,f)},d=a=>{const f=a.validate();return typeof f.then=="function"?f.then(b=>({valid:b,comp:a}),b=>({valid:!1,comp:a,err:b})):Promise.resolve({valid:f,comp:a})};return(e.greedy===!0?Promise.all(y.map(d)).then(a=>a.filter(f=>f.valid!==!0)):y.reduce((a,f)=>a.then(()=>d(f).then(b=>{if(b.valid===!1)return Promise.reject(b)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return i===r&&c(!0),!0;if(i===r){const{comp:f,err:b}=a[0];if(b!==void 0&&console.error(b),c(!1,f),o===!0){const R=a.find(({comp:D})=>typeof D.focus=="function"&&ae(D.$)===!1);R!==void 0&&R.comp.focus()}}return!1})}function x(){r++,y.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function q(t){t!==void 0&&F(t);const o=r+1;w().then(i=>{o===r&&i===!0&&(e.onSubmit!==void 0?n("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function u(t){t!==void 0&&F(t),n("reset"),ne(()=>{x(),e.autofocus===!0&&e.noResetFocus!==!0&&m()})}function m(){oe(()=>{if(l.value===null)return;const t=l.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||l.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||l.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(l.value.querySelectorAll("[tabindex]"),o=>o.tabIndex!==-1);t?.focus({preventScroll:!0})})}Y(se,{bindComponent(t){y.push(t)},unbindComponent(t){const o=y.indexOf(t);o!==-1&&y.splice(o,1)}});let h=!1;return Z(()=>{h=!0}),ee(()=>{h===!0&&e.autofocus===!0&&m()}),te(()=>{e.autofocus===!0&&m()}),Object.assign(p.proxy,{validate:w,resetValidation:x,submit:q,reset:u,focus:m,getValidationComponents:()=>y}),()=>B("form",{class:"q-form",ref:l,onSubmit:q,onReset:u},W(s.default))}}),Ie=$({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:s}){const n=E(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>B("div",{class:n.value},W(s.default))}}),Qe=$({name:"QItem",props:{...le,...re,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:s,emit:n}){const{proxy:{$q:p}}=z(),l=ie(e,p),{hasLink:r,linkAttrs:y,linkClass:w,linkTag:x,navigateOnClick:q}=ue(),u=N(null),m=N(null),h=E(()=>e.clickable===!0||r.value===!0||e.tag==="label"),t=E(()=>e.disable!==!0&&h.value===!0),o=E(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(l.value===!0?" q-item--dark":"")+(r.value===!0&&e.active===null?w.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(t.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),i=E(()=>e.insetLevel===void 0?null:{["padding"+(p.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function c(a){t.value===!0&&(m.value!==null&&(a.qKeyEvent!==!0&&document.activeElement===u.value?m.value.focus():document.activeElement===m.value&&u.value.focus()),q(a))}function d(a){if(t.value===!0&&H(a,[13,32])===!0){F(a),a.qKeyEvent=!0;const f=new MouseEvent("click",a);f.qKeyEvent=!0,u.value.dispatchEvent(f)}n("keyup",a)}function v(){const a=ce(s.default,[]);return t.value===!0&&a.unshift(B("div",{class:"q-focus-helper",tabindex:-1,ref:m})),a}return()=>{const a={ref:u,class:o.value,style:i.value,role:"listitem",onClick:c,onKeyup:d};return t.value===!0?(a.tabindex=e.tabindex||"0",Object.assign(a,y.value)):h.value===!0&&(a["aria-disabled"]="true"),B(x.value,a,v())}}});function O(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const s=parseInt(e,10);return isNaN(s)?0:s}const Ae=de({name:"close-popup",beforeMount(e,{value:s}){const n={depth:O(s),handler(p){n.depth!==0&&setTimeout(()=>{const l=fe(e);l!==void 0&&me(l,p,n.depth)})},handlerKey(p){H(p,13)===!0&&n.handler(p)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:s,oldValue:n}){s!==n&&(e.__qclosepopup.depth=O(s))},beforeUnmount(e){const s=e.__qclosepopup;e.removeEventListener("click",s.handler),e.removeEventListener("keyup",s.handlerKey),delete e.__qclosepopup}});function Fe(){const{buildTree:e}=ve(),{getStatus:s}=pe(),{storeUrl:n}=ye(he()),{navigate:p}=Ve(),{error:l}=Pe(),{t:r}=L(),y=async(t,o,i,c="")=>{const d={label:t,path:o,content:c,type:i};if(await u(t,o,i)){l(r("notify.fileExists"));return}(await s()).connected&&n.value&&await P.post("/item",d);const a=await g.treeNode.add(d);return await e(),a},w=async(t,o)=>{if(await g.treeNode.update(t.id,ge(o)),o.type==="directory"){const i=t.path+"/"+t.label,c=o.path+"/"+o.label;await g.treeNode.where("path").startsWith(i).modify(d=>{d.path=d.path.replace(i,c)})}},x=async(t,o,i,c,d)=>{const v=await g.treeNode.get(t);if(v===void 0)return;const a={label:v.label,path:v.path,content:v.content,type:v.type},f={label:o,path:i,content:d,type:c};if(m(a,f))return await p("home"),t;if(await u(o,i,c)){l(r("notify.fileExists"));return}return(await s()).connected&&n.value&&await P.put("/item",{old_item:a,new_item:f}),await w({...a,id:v.id},{...f,id:v.id}),await e(),t},q=async(t,o,i,c,d)=>{const v=await g.treeNode.get(t);if(v===void 0)return;await g.treeNode.delete(t),v.type==="directory"&&await g.treeNode.where("path").startsWith(v.path+"/"+v.label).delete(),(await s()).connected&&n.value&&await P.delete("/item",{data:{label:o,path:i,type:c,content:d}}),await e()},u=async(t,o,i)=>(await g.treeNode.filter(d=>d.label===t&&d.type===i&&d.path===o).toArray()).length>0,m=(t,o)=>t.label===o.label&&t.type===o.type&&t.path===o.path&&t.content===o.content;return{createNode:y,editNode:x,deleteNode:q,getFolders:async t=>{const o=JSON.parse(be.getItem("selectedNode")??"null");return(await g.treeNode.where("path").equals(t).filter(c=>c.type==="directory"&&(o===null||c.id!==o.id)).toArray()).map(c=>c.label)},isExists:u,areEqual:m}}const $e={class:"text-h6"},Le={key:0,class:"h-full flex flex-center text-grey-7"},Ue=G({__name:"PathInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=L(),n=J(e,"modelValue"),{getFolders:p}=Fe(),l=N([]),r=N(!1),y=N("slide-left");ke(n,async()=>{l.value=await p(n.value)});const w=()=>{y.value="slide-right",n.value=n.value.split("/").slice(0,-1).join("/")||""},x=u=>{y.value="slide-left",n.value=n.value.replace(/\/?$/,"/")+u},q=async()=>{l.value=await p(n.value),r.value=!0};return(u,m)=>(S(),I(M,null,[k(X,{filled:"",type:"text",modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=h=>n.value=h),label:C(s)("form.path"),onClick:q,readonly:"",hint:""},null,8,["modelValue","label"]),k(Se,{modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=h=>r.value=h)},{default:_(()=>[k(we,{class:Q([u.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md h-[300px] flex flex-col"])},{default:_(()=>[k(K,{class:Q([u.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:_(()=>[T("div",$e,A(C(s)("form.path")),1),T("div",null,[n.value!==""?(S(),V(j,{key:0,flat:"",color:u.$q.dark.isActive?"primary":"white",label:C(s)("button.back"),onClick:w},null,8,["color","label"])):xe("",!0),U(k(j,{flat:"",color:u.$q.dark.isActive?"primary":"white",label:C(s)("button.ok")},null,8,["color","label"]),[[Ae]])])]),_:1},8,["class"]),k(K,{class:"p-4 flex-1 overflow-auto"},{default:_(()=>[l.value.length===0?(S(),I("div",Le,A(C(s)("message.moveHere")),1)):(S(),V(Be,{transition:y.value,"transition-duration":700,key:l.value.length},{default:_(()=>[(S(!0),I(M,null,qe(l.value,h=>U((S(),V(Qe,{key:h,clickable:"",class:Q([u.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:t=>x(h)},{default:_(()=>[k(Ce,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),k(Ie,null,{default:_(()=>[Ne(A(h),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[Ee]])),128))]),_:1},8,["transition"]))]),_:1}),k(_e)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Me=G({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=L(),n=J(e,"modelValue");return(p,l)=>(S(),V(X,{filled:"",clearable:"",type:"text",modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=r=>n.value=r),label:C(s)("form.name"),rules:[r=>r&&r.length>0]},null,8,["modelValue","label","rules"]))}});export{je as Q,Me as _,Ue as a,Fe as u};
