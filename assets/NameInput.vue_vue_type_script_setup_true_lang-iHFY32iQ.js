import{a as L,r as N,q as Y,C as Z,D as ee,o as te,h as P,d as W,g as z,ax as ae,y as F,f as ne,ay as oe,az as se,b as E,L as le,aA as re,M as ie,aB as ue,v as H,p as ce,a8 as de,aC as fe,aD as me,an as ve,aE as pe,a0 as ye,aF as he,as as be,P as $,aG as B,aw as g,S as ge,aH as ke,O as J,au as G,w as we,T as S,U as I,V as k,Z as C,ao as X,W as _,aI as qe,aJ as Q,aK as K,X as T,Y as A,a2 as V,_ as M,a6 as xe,u as j,aq as U,ar as _e,aL as Se,aM as Ce,Q as Ne,a3 as Ee,R as Ve}from"./index-EkAxMetF.js";import{a as Pe,Q as Be}from"./QIntersection-RGwNLVmW.js";const Ke=L({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:n}){const v=z(),l=N(null);let r=0;const p=[];function w(t){const o=typeof t=="boolean"?t:e.noErrorFocus!==!0,i=++r,c=(a,f)=>{n(`validation${a===!0?"Success":"Error"}`,f)},d=a=>{const f=a.validate();return typeof f.then=="function"?f.then(b=>({valid:b,comp:a}),b=>({valid:!1,comp:a,err:b})):Promise.resolve({valid:f,comp:a})};return(e.greedy===!0?Promise.all(p.map(d)).then(a=>a.filter(f=>f.valid!==!0)):p.reduce((a,f)=>a.then(()=>d(f).then(b=>{if(b.valid===!1)return Promise.reject(b)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return i===r&&c(!0),!0;if(i===r){const{comp:f,err:b}=a[0];if(b!==void 0&&console.error(b),c(!1,f),o===!0){const D=a.find(({comp:R})=>typeof R.focus=="function"&&ae(R.$)===!1);D!==void 0&&D.comp.focus()}}return!1})}function q(){r++,p.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function x(t){t!==void 0&&F(t);const o=r+1;w().then(i=>{o===r&&i===!0&&(e.onSubmit!==void 0?n("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function u(t){t!==void 0&&F(t),n("reset"),ne(()=>{q(),e.autofocus===!0&&e.noResetFocus!==!0&&m()})}function m(){oe(()=>{if(l.value===null)return;const t=l.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||l.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||l.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(l.value.querySelectorAll("[tabindex]"),o=>o.tabIndex!==-1);t?.focus({preventScroll:!0})})}Y(se,{bindComponent(t){p.push(t)},unbindComponent(t){const o=p.indexOf(t);o!==-1&&p.splice(o,1)}});let y=!1;return Z(()=>{y=!0}),ee(()=>{y===!0&&e.autofocus===!0&&m()}),te(()=>{e.autofocus===!0&&m()}),Object.assign(v.proxy,{validate:w,resetValidation:q,submit:x,reset:u,focus:m,getValidationComponents:()=>p}),()=>P("form",{class:"q-form",ref:l,onSubmit:x,onReset:u},W(s.default))}}),Ie=L({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:s}){const n=E(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>P("div",{class:n.value},W(s.default))}}),Qe=L({name:"QItem",props:{...le,...re,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:s,emit:n}){const{proxy:{$q:v}}=z(),l=ie(e,v),{hasLink:r,linkAttrs:p,linkClass:w,linkTag:q,navigateOnClick:x}=ue(),u=N(null),m=N(null),y=E(()=>e.clickable===!0||r.value===!0||e.tag==="label"),t=E(()=>e.disable!==!0&&y.value===!0),o=E(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(l.value===!0?" q-item--dark":"")+(r.value===!0&&e.active===null?w.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(t.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),i=E(()=>e.insetLevel===void 0?null:{["padding"+(v.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function c(a){t.value===!0&&(m.value!==null&&(a.qKeyEvent!==!0&&document.activeElement===u.value?m.value.focus():document.activeElement===m.value&&u.value.focus()),x(a))}function d(a){if(t.value===!0&&H(a,[13,32])===!0){F(a),a.qKeyEvent=!0;const f=new MouseEvent("click",a);f.qKeyEvent=!0,u.value.dispatchEvent(f)}n("keyup",a)}function h(){const a=ce(s.default,[]);return t.value===!0&&a.unshift(P("div",{class:"q-focus-helper",tabindex:-1,ref:m})),a}return()=>{const a={ref:u,class:o.value,style:i.value,role:"listitem",onClick:c,onKeyup:d};return t.value===!0?(a.tabindex=e.tabindex||"0",Object.assign(a,p.value)):y.value===!0&&(a["aria-disabled"]="true"),P(q.value,a,h())}}});function O(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const s=parseInt(e,10);return isNaN(s)?0:s}const Ae=de({name:"close-popup",beforeMount(e,{value:s}){const n={depth:O(s),handler(v){n.depth!==0&&setTimeout(()=>{const l=fe(e);l!==void 0&&me(l,v,n.depth)})},handlerKey(v){H(v,13)===!0&&n.handler(v)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:s,oldValue:n}){s!==n&&(e.__qclosepopup.depth=O(s))},beforeUnmount(e){const s=e.__qclosepopup;e.removeEventListener("click",s.handler),e.removeEventListener("keyup",s.handlerKey),delete e.__qclosepopup}});function Fe(){const{buildTree:e}=ve(),{getStatus:s}=pe(),{storeUrl:n}=ye(he()),{navigate:v}=Pe(),{error:l}=be(),{t:r}=$(),p=async(t,o,i,c="")=>{const d={label:t,path:o,content:c,type:i};if(await u(t,o,i)){l(r("notify.fileExists"));return}if((await s()).connected&&n.value)try{await B.post("/",d)}catch{l(r("notify.error"))}const a=await g.treeNode.add(d);return await e(),a},w=async(t,o)=>{if(await g.treeNode.update(t.id,ke(o)),o.type==="directory"){const i=t.path+"/"+t.label,c=o.path+"/"+o.label;await g.treeNode.where("path").startsWith(i).modify(d=>{d.path=d.path.replace(i,c)})}},q=async(t,o,i,c,d)=>{const h=await g.treeNode.get(t);if(h===void 0)return;const a={label:h.label,path:h.path,content:h.content,type:h.type},f={label:o,path:i,content:d,type:c};if(m(a,f))return await v("home"),t;if(await u(o,i,c)){l(r("notify.fileExists"));return}if((await s()).connected&&n.value)try{await B.put("/item",{old_item:a,new_item:f})}catch{l(r("server.error"))}return await w({...a,id:h.id},{...f,id:h.id}),await e(),t},x=async(t,o,i,c,d)=>{if((await s()).connected&&n.value)try{await B.delete("/item",{data:{label:o,path:i,type:c,content:d}})}catch{l(r("server.error"))}const a=await g.treeNode.get(t);a!==void 0&&(await g.treeNode.delete(t),a.type==="directory"&&await g.treeNode.where("path").startsWith(a.path+"/"+a.label).delete(),await e())},u=async(t,o,i)=>(await g.treeNode.filter(d=>d.label===t&&d.type===i&&d.path===o).toArray()).length>0,m=(t,o)=>t.label===o.label&&t.type===o.type&&t.path===o.path&&t.content===o.content;return{createNode:p,editNode:q,deleteNode:x,getFolders:async t=>{const o=JSON.parse(ge.getItem("selectedNode")??"null");return(await g.treeNode.where("path").equals(t).filter(c=>c.type==="directory"&&(o===null||c.id!==o.id)).toArray()).map(c=>c.label)},isExists:u,areEqual:m}}const Le={class:"text-h6"},$e={key:0,class:"h-full flex flex-center text-grey-7"},Te=J({__name:"PathInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=$(),n=G(e,"modelValue"),{getFolders:v}=Fe(),l=N([]),r=N(!1),p=N("slide-left");we(n,async()=>{l.value=await v(n.value)});const w=()=>{p.value="slide-right",n.value=n.value.split("/").slice(0,-1).join("/")||""},q=u=>{p.value="slide-left",n.value=n.value.replace(/\/?$/,"/")+u},x=async()=>{l.value=await v(n.value),r.value=!0};return(u,m)=>(S(),I(U,null,[k(X,{filled:"",type:"text",modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=y=>n.value=y),label:C(s)("form.path"),onClick:x,readonly:"",hint:""},null,8,["modelValue","label"]),k(Ce,{modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=y=>r.value=y)},{default:_(()=>[k(qe,{class:Q([u.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md h-[300px] flex flex-col"])},{default:_(()=>[k(K,{class:Q([u.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:_(()=>[T("div",Le,A(C(s)("form.path")),1),T("div",null,[n.value!==""?(S(),V(M,{key:0,flat:"",color:u.$q.dark.isActive?"primary":"white",label:C(s)("button.back"),onClick:w},null,8,["color","label"])):xe("",!0),j(k(M,{flat:"",color:u.$q.dark.isActive?"primary":"white",label:C(s)("button.ok")},null,8,["color","label"]),[[Ae]])])]),_:1},8,["class"]),k(K,{class:"p-4 flex-1 overflow-auto"},{default:_(()=>[l.value.length===0?(S(),I("div",$e,A(C(s)("message.moveHere")),1)):(S(),V(Be,{transition:p.value,"transition-duration":700,key:l.value.length},{default:_(()=>[(S(!0),I(U,null,_e(l.value,y=>j((S(),V(Qe,{key:y,clickable:"",class:Q([u.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:t=>q(y)},{default:_(()=>[k(Ne,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),k(Ie,null,{default:_(()=>[Ee(A(y),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[Ve]])),128))]),_:1},8,["transition"]))]),_:1}),k(Se)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Me=J({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=$(),n=G(e,"modelValue");return(v,l)=>(S(),V(X,{filled:"",clearable:"",type:"text",modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=r=>n.value=r),label:C(s)("form.name"),rules:[r=>r&&r.length>0]},null,8,["modelValue","label","rules"]))}});export{Ke as Q,Me as _,Te as a,Fe as u};
