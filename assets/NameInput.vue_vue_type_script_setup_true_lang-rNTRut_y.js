import{c as $,r as _,p as J,B as Z,C as ee,o as te,h as B,b as O,g as z,ar as ae,x as I,e as ne,as as le,at as oe,a as C,K as se,au as ue,L as re,av as ie,u as W,m as ce,a5 as de,aw as fe,ax as me,ak as N,ay as D,N as H,az as ve,aq as X,w as pe,P as k,S as E,T as b,X as x,al as Y,U as g,aA as be,aB as Q,aC as R,V as K,W as P,$ as w,Y as T,a3 as he,s as j,an as M,ao as ye,aD as ge,aE as ke,Q as qe,a0 as xe,R as _e}from"./index-759gVJRL.js";import{Q as Ce}from"./QIntersection-CSionbZX.js";import{u as G}from"./vue-i18n-DVSXxbpl.js";const Fe=$({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:n}){const c=z(),l=_(null);let o=0;const u=[];function f(t){const m=typeof t=="boolean"?t:e.noErrorFocus!==!0,q=++o,S=(a,d)=>{n(`validation${a===!0?"Success":"Error"}`,d)},V=a=>{const d=a.validate();return typeof d.then=="function"?d.then(p=>({valid:p,comp:a}),p=>({valid:!1,comp:a,err:p})):Promise.resolve({valid:d,comp:a})};return(e.greedy===!0?Promise.all(u.map(V)).then(a=>a.filter(d=>d.valid!==!0)):u.reduce((a,d)=>a.then(()=>V(d).then(p=>{if(p.valid===!1)return Promise.reject(p)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return q===o&&S(!0),!0;if(q===o){const{comp:d,err:p}=a[0];if(p!==void 0&&console.error(p),S(!1,d),m===!0){const A=a.find(({comp:L})=>typeof L.focus=="function"&&ae(L.$)===!1);A!==void 0&&A.comp.focus()}}return!1})}function h(){o++,u.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function y(t){t!==void 0&&I(t);const m=o+1;f().then(q=>{m===o&&q===!0&&(e.onSubmit!==void 0?n("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function i(t){t!==void 0&&I(t),n("reset"),ne(()=>{h(),e.autofocus===!0&&e.noResetFocus!==!0&&r()})}function r(){le(()=>{if(l.value===null)return;const t=l.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||l.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||l.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(l.value.querySelectorAll("[tabindex]"),m=>m.tabIndex!==-1);t?.focus({preventScroll:!0})})}J(oe,{bindComponent(t){u.push(t)},unbindComponent(t){const m=u.indexOf(t);m!==-1&&u.splice(m,1)}});let v=!1;return Z(()=>{v=!0}),ee(()=>{v===!0&&e.autofocus===!0&&r()}),te(()=>{e.autofocus===!0&&r()}),Object.assign(c.proxy,{validate:f,resetValidation:h,submit:y,reset:i,focus:r,getValidationComponents:()=>u}),()=>B("form",{class:"q-form",ref:l,onSubmit:y,onReset:i},O(s.default))}}),Se=$({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:s}){const n=C(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>B("div",{class:n.value},O(s.default))}}),Ve=$({name:"QItem",props:{...se,...ue,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:s,emit:n}){const{proxy:{$q:c}}=z(),l=re(e,c),{hasLink:o,linkAttrs:u,linkClass:f,linkTag:h,navigateOnClick:y}=ie(),i=_(null),r=_(null),v=C(()=>e.clickable===!0||o.value===!0||e.tag==="label"),t=C(()=>e.disable!==!0&&v.value===!0),m=C(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(l.value===!0?" q-item--dark":"")+(o.value===!0&&e.active===null?f.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(t.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),q=C(()=>e.insetLevel===void 0?null:{["padding"+(c.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function S(a){t.value===!0&&(r.value!==null&&(a.qKeyEvent!==!0&&document.activeElement===i.value?r.value.focus():document.activeElement===r.value&&i.value.focus()),y(a))}function V(a){if(t.value===!0&&W(a,[13,32])===!0){I(a),a.qKeyEvent=!0;const d=new MouseEvent("click",a);d.qKeyEvent=!0,i.value.dispatchEvent(d)}n("keyup",a)}function F(){const a=ce(s.default,[]);return t.value===!0&&a.unshift(B("div",{class:"q-focus-helper",tabindex:-1,ref:r})),a}return()=>{const a={ref:i,class:m.value,style:q.value,role:"listitem",onClick:S,onKeyup:V};return t.value===!0?(a.tabindex=e.tabindex||"0",Object.assign(a,u.value)):v.value===!0&&(a["aria-disabled"]="true"),B(h.value,a,F())}}});function U(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const s=parseInt(e,10);return isNaN(s)?0:s}const we=de({name:"close-popup",beforeMount(e,{value:s}){const n={depth:U(s),handler(c){n.depth!==0&&setTimeout(()=>{const l=fe(e);l!==void 0&&me(l,c,n.depth)})},handlerKey(c){W(c,13)===!0&&n.handler(c)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:s,oldValue:n}){s!==n&&(e.__qclosepopup.depth=U(s))},beforeUnmount(e){const s=e.__qclosepopup;e.removeEventListener("click",s.handler),e.removeEventListener("keyup",s.handlerKey),delete e.__qclosepopup}});function Be(){const{setTree:e}=N();return{createNode:async l=>{const o={label:l.label,path:l.path,content:l.content,type:l.type,children:[]};await D.post("/item",o),await e()},editNode:async(l,o)=>{const u={label:l.label,path:l.path,content:l.content,type:l.type,children:[]},f={label:o.label,path:o.path,content:o.content,type:o.type,children:[]};await D.put("/item",{old_item:u,new_item:f}),await e()},getFolders:(l,o)=>{const u=[],f=y=>{for(const i of y)i.path===l&&i.type==="directory"&&i.label!==o&&u.push(i.label),i.children&&f(i.children)},{tree:h}=N();return f(h),u}}}const Ee={class:"text-h6"},Qe={key:0,class:"h-full flex flex-center text-grey-7"},Ae=H({__name:"PathInput",props:ve({label:{type:String,required:!0}},{modelValue:{type:String,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const{t:s}=G(),n=X(e,"modelValue"),c=e,{getFolders:l}=Be(),o=_(l(n.value,c.label)),u=_(!1),f=_("slide-left");pe(n,()=>{o.value=l(n.value,c.label)});const h=()=>{f.value="slide-right",n.value=n.value.split("/").slice(0,-1).join("/")||"/"},y=r=>{f.value="slide-left",n.value=n.value.replace(/\/?$/,"/")+r},i=()=>{o.value=l(n.value,c.label),u.value=!0};return(r,v)=>(k(),E(M,null,[b(Y,{filled:"",type:"text",modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=t=>n.value=t),label:x(s)("form.path"),onClick:i,readonly:"",hint:""},null,8,["modelValue","label"]),b(ke,{modelValue:u.value,"onUpdate:modelValue":v[1]||(v[1]=t=>u.value=t)},{default:g(()=>[b(be,{class:Q([r.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md h-[300px] flex flex-col"])},{default:g(()=>[b(R,{class:Q([r.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:g(()=>[K("div",Ee,P(x(s)("form.path")),1),K("div",null,[n.value!=="/"?(k(),w(T,{key:0,flat:"",color:r.$q.dark.isActive?"primary":"white",label:x(s)("button.back"),onClick:h},null,8,["color","label"])):he("",!0),j(b(T,{flat:"",color:r.$q.dark.isActive?"primary":"white",label:x(s)("button.ok")},null,8,["color","label"]),[[we]])])]),_:1},8,["class"]),b(R,{class:"p-4 flex-1 overflow-auto"},{default:g(()=>[o.value.length===0?(k(),E("div",Qe,P(x(s)("message.moveHere")),1)):(k(),w(Ce,{transition:f.value,"transition-duration":700,key:o.value.length},{default:g(()=>[(k(!0),E(M,null,ye(o.value,t=>j((k(),w(Ve,{key:t,clickable:"",class:Q([r.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:m=>y(t)},{default:g(()=>[b(qe,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),b(Se,null,{default:g(()=>[xe(P(t),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[_e]])),128))]),_:1},8,["transition"]))]),_:1}),b(ge)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Le=H({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=G(),n=X(e,"modelValue");return(c,l)=>(k(),w(Y,{filled:"",clearable:"",type:"text",modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=o=>n.value=o),label:x(s)("form.name"),rules:[o=>o&&o.length>0]},null,8,["modelValue","label","rules"]))}});export{Fe as Q,Le as _,Ae as a,Be as u};
