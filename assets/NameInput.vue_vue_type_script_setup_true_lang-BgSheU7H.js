import{c as $,r as w,p as J,B as Z,C as ee,o as te,h as E,b as O,g as W,ap as ae,x as I,e as ne,aq as oe,ar as le,a as _,K as se,as as ue,L as re,at as ie,u as z,m as ce,a5 as de,au as fe,av as me,aj as ve,aw as pe,O as he,ax as be,ay as R,az as V,aA as ye,N as H,ao as X,w as ge,P as k,S as P,T as b,X as x,ak as Y,U as g,aB as ke,aC as Q,aD as D,V as K,W as F,$ as B,Y as T,a3 as qe,s as j,am as U,an as xe,aE as we,aF as _e,Q as Ce,a0 as Se,R as Ve}from"./index-91QBpGec.js";import{Q as Be}from"./QIntersection-vB2e5Jkm.js";import{u as G}from"./vue-i18n-Chy8k9Cj.js";const Re=$({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:o,emit:a}){const f=W(),u=w(null);let r=0;const m=[];function y(n){const p=typeof n=="boolean"?n:e.noErrorFocus!==!0,q=++r,C=(t,v)=>{a(`validation${t===!0?"Success":"Error"}`,v)},S=t=>{const v=t.validate();return typeof v.then=="function"?v.then(h=>({valid:h,comp:t}),h=>({valid:!1,comp:t,err:h})):Promise.resolve({valid:v,comp:t})};return(e.greedy===!0?Promise.all(m.map(S)).then(t=>t.filter(v=>v.valid!==!0)):m.reduce((t,v)=>t.then(()=>S(v).then(h=>{if(h.valid===!1)return Promise.reject(h)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return q===r&&C(!0),!0;if(q===r){const{comp:v,err:h}=t[0];if(h!==void 0&&console.error(h),C(!1,v),p===!0){const L=t.find(({comp:N})=>typeof N.focus=="function"&&ae(N.$)===!1);L!==void 0&&L.comp.focus()}}return!1})}function l(){r++,m.forEach(n=>{typeof n.resetValidation=="function"&&n.resetValidation()})}function i(n){n!==void 0&&I(n);const p=r+1;y().then(q=>{p===r&&q===!0&&(e.onSubmit!==void 0?a("submit",n):n!==void 0&&n.target!==void 0&&typeof n.target.submit=="function"&&n.target.submit())})}function s(n){n!==void 0&&I(n),a("reset"),ne(()=>{l(),e.autofocus===!0&&e.noResetFocus!==!0&&c()})}function c(){oe(()=>{if(u.value===null)return;const n=u.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||u.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||u.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(u.value.querySelectorAll("[tabindex]"),p=>p.tabIndex!==-1);n?.focus({preventScroll:!0})})}J(le,{bindComponent(n){m.push(n)},unbindComponent(n){const p=m.indexOf(n);p!==-1&&m.splice(p,1)}});let d=!1;return Z(()=>{d=!0}),ee(()=>{d===!0&&e.autofocus===!0&&c()}),te(()=>{e.autofocus===!0&&c()}),Object.assign(f.proxy,{validate:y,resetValidation:l,submit:i,reset:s,focus:c,getValidationComponents:()=>m}),()=>E("form",{class:"q-form",ref:u,onSubmit:i,onReset:s},O(o.default))}}),Ee=$({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:o}){const a=_(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>E("div",{class:a.value},O(o.default))}}),Pe=$({name:"QItem",props:{...se,...ue,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:o,emit:a}){const{proxy:{$q:f}}=W(),u=re(e,f),{hasLink:r,linkAttrs:m,linkClass:y,linkTag:l,navigateOnClick:i}=ie(),s=w(null),c=w(null),d=_(()=>e.clickable===!0||r.value===!0||e.tag==="label"),n=_(()=>e.disable!==!0&&d.value===!0),p=_(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(u.value===!0?" q-item--dark":"")+(r.value===!0&&e.active===null?y.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(n.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),q=_(()=>e.insetLevel===void 0?null:{["padding"+(f.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function C(t){n.value===!0&&(c.value!==null&&(t.qKeyEvent!==!0&&document.activeElement===s.value?c.value.focus():document.activeElement===c.value&&s.value.focus()),i(t))}function S(t){if(n.value===!0&&z(t,[13,32])===!0){I(t),t.qKeyEvent=!0;const v=new MouseEvent("click",t);v.qKeyEvent=!0,s.value.dispatchEvent(v)}a("keyup",t)}function A(){const t=ce(o.default,[]);return n.value===!0&&t.unshift(E("div",{class:"q-focus-helper",tabindex:-1,ref:c})),t}return()=>{const t={ref:s,class:p.value,style:q.value,role:"listitem",onClick:C,onKeyup:S};return n.value===!0?(t.tabindex=e.tabindex||"0",Object.assign(t,m.value)):d.value===!0&&(t["aria-disabled"]="true"),E(l.value,t,A())}}});function M(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const o=parseInt(e,10);return isNaN(o)?0:o}const Qe=de({name:"close-popup",beforeMount(e,{value:o}){const a={depth:M(o),handler(f){a.depth!==0&&setTimeout(()=>{const u=fe(e);u!==void 0&&me(u,f,a.depth)})},handlerKey(f){z(f,13)===!0&&a.handler(f)}};e.__qclosepopup=a,e.addEventListener("click",a.handler),e.addEventListener("keyup",a.handlerKey)},updated(e,{value:o,oldValue:a}){o!==a&&(e.__qclosepopup.depth=M(o))},beforeUnmount(e){const o=e.__qclosepopup;e.removeEventListener("click",o.handler),e.removeEventListener("keyup",o.handlerKey),delete e.__qclosepopup}});function Fe(){const{buildTree:e}=ve(),{getStatus:o}=pe(),{storeUrl:a}=he(be()),f=async l=>{if((await o()).connected&&a.value){const s={label:l.label,path:l.path,content:l.content,type:l.type,children:[]};await R.post("/item",s)}await u(l),await e()},u=async l=>{await V.treeNode.add(l)},r=async(l,i)=>{await V.treeNode.update(l.id,ye(i));const s=l.path+"/"+l.label,c=i.path+"/"+i.label;await V.treeNode.where("path").startsWith(s).modify(d=>{d.path=d.path.replace(s,c)})};return{createNode:f,editNode:async(l,i)=>{if((await o()).connected&&a.value){const c={label:l.label,path:l.path,content:l.content,type:l.type,children:[]},d={label:i.label,path:i.path,content:i.content,type:i.type,children:[]};await R.put("/item",{old_item:c,new_item:d})}await r(l,i),await e()},getFolders:async l=>(await V.treeNode.where("path").equals(l).toArray()).map(s=>s.label)}}const Ie={class:"text-h6"},$e={key:0,class:"h-full flex flex-center text-grey-7"},De=H({__name:"PathInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:o}=G(),a=X(e,"modelValue"),{getFolders:f}=Fe(),u=w([]),r=w(!1),m=w("slide-left");ge(a,async()=>{u.value=await f(a.value)});const y=()=>{m.value="slide-right",a.value=a.value.split("/").slice(0,-1).join("/")||""},l=s=>{m.value="slide-left",a.value=a.value.replace(/\/?$/,"/")+s},i=async()=>{u.value=await f(a.value),r.value=!0};return(s,c)=>(k(),P(U,null,[b(Y,{filled:"",type:"text",modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=d=>a.value=d),label:x(o)("form.path"),onClick:i,readonly:"",hint:""},null,8,["modelValue","label"]),b(_e,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=d=>r.value=d)},{default:g(()=>[b(ke,{class:Q([s.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md h-[300px] flex flex-col"])},{default:g(()=>[b(D,{class:Q([s.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:g(()=>[K("div",Ie,F(x(o)("form.path")),1),K("div",null,[a.value!=="/"?(k(),B(T,{key:0,flat:"",color:s.$q.dark.isActive?"primary":"white",label:x(o)("button.back"),onClick:y},null,8,["color","label"])):qe("",!0),j(b(T,{flat:"",color:s.$q.dark.isActive?"primary":"white",label:x(o)("button.ok")},null,8,["color","label"]),[[Qe]])])]),_:1},8,["class"]),b(D,{class:"p-4 flex-1 overflow-auto"},{default:g(()=>[u.value.length===0?(k(),P("div",$e,F(x(o)("message.moveHere")),1)):(k(),B(Be,{transition:m.value,"transition-duration":700,key:u.value.length},{default:g(()=>[(k(!0),P(U,null,xe(u.value,d=>j((k(),B(Pe,{key:d,clickable:"",class:Q([s.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:n=>l(d)},{default:g(()=>[b(Ce,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),b(Ee,null,{default:g(()=>[Se(F(d),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[Ve]])),128))]),_:1},8,["transition"]))]),_:1}),b(we)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Ke=H({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:o}=G(),a=X(e,"modelValue");return(f,u)=>(k(),B(Y,{filled:"",clearable:"",type:"text",modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=r=>a.value=r),label:x(o)("form.name"),rules:[r=>r&&r.length>0]},null,8,["modelValue","label","rules"]))}});export{Re as Q,Ke as _,De as a,Fe as u};
