import{a as L,r as N,C as Y,D as Z,o as ee,g as W,h as P,d as z,ax as te,z as F,f as ae,ay as oe,q as ne,az as re,b as E,aA as se,L as le,M as ie,aB as ue,x as H,p as ce,a8 as de,aC as fe,aD as ve,an as me,aE as pe,a0 as he,aF as ye,as as be,P as $,aw as g,S as ge,aG as B,aH as we,O as J,au as G,w as ke,T as I,U as C,aq as K,V as w,ao as X,Z as S,aI as xe,W as _,aJ as qe,aK as Q,aL as T,X as M,Y as A,a1 as V,a2 as _e,u as j,_ as U,ar as Ce,aM as Se,Q as Ne,a3 as Ee,R as Ve}from"./index-DOp7FRSV.js";import{a as Pe,Q as Be}from"./QIntersection-h_eib351.js";const Ke=L({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:r,emit:o}){const p=W(),s=N(null);let l=0;const h=[];function k(t){const n=typeof t=="boolean"?t:e.noErrorFocus!==!0,i=++l,u=(a,f)=>{o(`validation${a===!0?"Success":"Error"}`,f)},c=a=>{const f=a.validate();return typeof f.then=="function"?f.then(b=>({valid:b,comp:a}),b=>({valid:!1,comp:a,err:b})):Promise.resolve({valid:f,comp:a})};return(e.greedy===!0?Promise.all(h.map(c)).then(a=>a.filter(f=>f.valid!==!0)):h.reduce((a,f)=>a.then(()=>c(f).then(b=>{if(b.valid===!1)return Promise.reject(b)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return i===l&&u(!0),!0;if(i===l){const{comp:f,err:b}=a[0];if(b!==void 0&&console.error(b),u(!1,f),n===!0){const D=a.find(({comp:R})=>typeof R.focus=="function"&&te(R.$)===!1);D!==void 0&&D.comp.focus()}}return!1})}function x(){l++,h.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function q(t){t!==void 0&&F(t);const n=l+1;k().then(i=>{n===l&&i===!0&&(e.onSubmit!==void 0?o("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function d(t){t!==void 0&&F(t),o("reset"),ae(()=>{x(),e.autofocus===!0&&e.noResetFocus!==!0&&v()})}function v(){oe(()=>{if(s.value===null)return;const t=s.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||s.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||s.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(s.value.querySelectorAll("[tabindex]"),n=>n.tabIndex!==-1);t?.focus({preventScroll:!0})})}ne(re,{bindComponent(t){h.push(t)},unbindComponent(t){const n=h.indexOf(t);n!==-1&&h.splice(n,1)}});let y=!1;return Y(()=>{y=!0}),Z(()=>{y===!0&&e.autofocus===!0&&v()}),ee(()=>{e.autofocus===!0&&v()}),Object.assign(p.proxy,{validate:k,resetValidation:x,submit:q,reset:d,focus:v,getValidationComponents:()=>h}),()=>P("form",{class:"q-form",ref:s,onSubmit:q,onReset:d},z(r.default))}}),Ie=L({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:r}){const o=E(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>P("div",{class:o.value},z(r.default))}}),Qe=L({name:"QItem",props:{...le,...se,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:r,emit:o}){const{proxy:{$q:p}}=W(),s=ie(e,p),{hasLink:l,linkAttrs:h,linkClass:k,linkTag:x,navigateOnClick:q}=ue(),d=N(null),v=N(null),y=E(()=>e.clickable===!0||l.value===!0||e.tag==="label"),t=E(()=>e.disable!==!0&&y.value===!0),n=E(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(s.value===!0?" q-item--dark":"")+(l.value===!0&&e.active===null?k.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(t.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),i=E(()=>e.insetLevel===void 0?null:{["padding"+(p.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function u(a){t.value===!0&&(v.value!==null&&(a.qKeyEvent!==!0&&document.activeElement===d.value?v.value.focus():document.activeElement===v.value&&d.value.focus()),q(a))}function c(a){if(t.value===!0&&H(a,[13,32])===!0){F(a),a.qKeyEvent=!0;const f=new MouseEvent("click",a);f.qKeyEvent=!0,d.value.dispatchEvent(f)}o("keyup",a)}function m(){const a=ce(r.default,[]);return t.value===!0&&a.unshift(P("div",{class:"q-focus-helper",tabindex:-1,ref:v})),a}return()=>{const a={ref:d,class:n.value,style:i.value,role:"listitem",onClick:u,onKeyup:c};return t.value===!0?(a.tabindex=e.tabindex||"0",Object.assign(a,h.value)):y.value===!0&&(a["aria-disabled"]="true"),P(x.value,a,m())}}});function O(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const r=parseInt(e,10);return isNaN(r)?0:r}const Ae=de({name:"close-popup",beforeMount(e,{value:r}){const o={depth:O(r),handler(p){o.depth!==0&&setTimeout(()=>{const s=fe(e);s!==void 0&&ve(s,p,o.depth)})},handlerKey(p){H(p,13)===!0&&o.handler(p)}};e.__qclosepopup=o,e.addEventListener("click",o.handler),e.addEventListener("keyup",o.handlerKey)},updated(e,{value:r,oldValue:o}){r!==o&&(e.__qclosepopup.depth=O(r))},beforeUnmount(e){const r=e.__qclosepopup;e.removeEventListener("click",r.handler),e.removeEventListener("keyup",r.handlerKey),delete e.__qclosepopup}});function Fe(){const{buildTree:e}=me(),{getStatus:r}=pe(),{storeUrl:o}=he(ye()),{navigate:p}=Pe(),{error:s}=be(),{t:l}=$(),h=async(t,n,i,u="")=>{const c={label:t,path:n,content:u,type:i};if(await d(t,n,i)){s(l("notify.fileExists"));return}if((await r()).connected&&o.value)try{await B.post("/item",c)}catch{s(l("server.error"));return}const a=await g.treeNode.add(c);return await e(),a},k=async(t,n)=>{if(await g.treeNode.update(t.id,we(n)),n.type==="directory"){const i=t.path+"/"+t.label,u=n.path+"/"+n.label;await g.treeNode.where("path").startsWith(i).modify(c=>{c.path=c.path.replace(i,u)})}},x=async(t,n,i,u,c)=>{const m=await g.treeNode.get(t);if(m===void 0)return;const a={label:m.label,path:m.path,content:m.content,type:m.type},f={label:n,path:i,content:c,type:u};if(v(a,f))return await p("home"),t;if(await d(n,i,u)&&m.path!==i){s(l("notify.fileExists"));return}if((await r()).connected&&o.value)try{await B.put("/item",{old_item:a,new_item:f})}catch{s(l("server.error"));return}return await k({...a,id:m.id},{...f,id:m.id}),await e(),t},q=async(t,n,i,u,c)=>{const m=await g.treeNode.get(t);if(m===void 0)return;if((await r()).connected&&o.value)try{await B.delete("/item",{data:{label:n,path:i,type:u,content:c}})}catch{throw s(l("server.error")),new Error(l("server.error"))}await g.treeNode.delete(t),m.type==="directory"&&await g.treeNode.where("path").startsWith(m.path+"/"+m.label).delete(),await e()},d=async(t,n,i)=>(await g.treeNode.filter(c=>c.label===t&&c.type===i&&c.path===n).toArray()).length>0,v=(t,n)=>t.label===n.label&&t.type===n.type&&t.path===n.path&&t.content===n.content;return{createNode:h,editNode:x,deleteNode:q,getFolders:async t=>{const n=JSON.parse(ge.getItem("selectedNode")??"null"),i=await g.treeNode.where("path").equals(t).filter(u=>u.type==="directory"&&(n===null||u.id!==n.id)).toArray();return i.sort((u,c)=>u.label.localeCompare(c.label)),i.map(u=>u.label)},isExists:d,areEqual:v}}const Le={class:"text-h6"},$e={key:0,class:"h-full flex flex-center text-grey-7"},Te=J({__name:"PathInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:r}=$(),o=G(e,"modelValue"),{getFolders:p}=Fe(),s=N([]),l=N(!1),h=N("slide-left");ke(o,async()=>{s.value=await p(o.value)});const k=()=>{h.value="slide-right",o.value=o.value.split("/").slice(0,-1).join("/")||""},x=d=>{h.value="slide-left",o.value=o.value.replace(/\/?$/,"/")+d},q=async()=>{s.value=await p(o.value),l.value=!0};return(d,v)=>(C(),I(K,null,[w(X,{filled:"",type:"text",modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=y=>o.value=y),label:S(r)("form.path"),onClick:q,readonly:"",hint:""},null,8,["modelValue","label"]),w(xe,{modelValue:l.value,"onUpdate:modelValue":v[1]||(v[1]=y=>l.value=y)},{default:_(()=>[w(qe,{class:Q([d.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md h-[300px] flex flex-col"])},{default:_(()=>[w(T,{class:Q([d.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:_(()=>[M("div",Le,A(S(r)("form.path")),1),M("div",null,[o.value!==""?(C(),V(U,{key:0,flat:"",color:d.$q.dark.isActive?"primary":"white",label:S(r)("button.back"),onClick:k},null,8,["color","label"])):_e("",!0),j(w(U,{flat:"",color:d.$q.dark.isActive?"primary":"white",label:S(r)("button.ok")},null,8,["color","label"]),[[Ae]])])]),_:1},8,["class"]),w(T,{class:"p-4 flex-1 overflow-auto"},{default:_(()=>[s.value.length===0?(C(),I("div",$e,A(S(r)("message.moveHere")),1)):(C(),V(Be,{transition:h.value,"transition-duration":700,key:s.value.length},{default:_(()=>[(C(!0),I(K,null,Ce(s.value,y=>j((C(),V(Qe,{key:y,clickable:"",class:Q([d.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:t=>x(y)},{default:_(()=>[w(Ne,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),w(Ie,null,{default:_(()=>[Ee(A(y),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[Ve]])),128))]),_:1},8,["transition"]))]),_:1}),w(Se)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Me=J({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:r}=$(),o=G(e,"modelValue");return(p,s)=>(C(),V(X,{filled:"",clearable:"",type:"text",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=l=>o.value=l),label:S(r)("form.name"),rules:[l=>l&&l.length>0]},null,8,["modelValue","label","rules"]))}});export{Ke as Q,Me as _,Te as a,Fe as u};
