import{c as F,r as E,p as Y,B as Z,C as ee,o as te,h as B,b as W,g as z,at as ae,x as A,e as ne,au as oe,av as se,a as V,K as le,aw as re,L as ie,ax as ue,u as H,m as ce,a6 as de,ay as fe,az as me,ak as ve,aA as pe,_ as ye,aB as he,aC as D,as as S,P as be,aD as ge,N as G,ap as J,w as ke,O as _,S as P,T as g,X as C,al as X,U as q,aE as we,aF as I,aG as K,V as T,W as Q,a0 as N,Y as j,a4 as xe,s as U,an as M,ao as qe,aH as _e,aI as Se,Q as Ce,a1 as Ee,R as Ve}from"./index-jbRim1TC.js";import{a as Ne,Q as Be}from"./QIntersection-BhjRnTQp.js";import{u as Pe}from"./useNotify-1MAFvV0r.js";import{u as $}from"./vue-i18n-gDOWfnQN.js";const je=F({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:n}){const f=z(),l=E(null);let i=0;const m=[];function k(t){const r=typeof t=="boolean"?t:e.noErrorFocus!==!0,u=++i,y=(a,p)=>{n(`validation${a===!0?"Success":"Error"}`,p)},d=a=>{const p=a.validate();return typeof p.then=="function"?p.then(b=>({valid:b,comp:a}),b=>({valid:!1,comp:a,err:b})):Promise.resolve({valid:p,comp:a})};return(e.greedy===!0?Promise.all(m.map(d)).then(a=>a.filter(p=>p.valid!==!0)):m.reduce((a,p)=>a.then(()=>d(p).then(b=>{if(b.valid===!1)return Promise.reject(b)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return u===i&&y(!0),!0;if(u===i){const{comp:p,err:b}=a[0];if(b!==void 0&&console.error(b),y(!1,p),r===!0){const L=a.find(({comp:R})=>typeof R.focus=="function"&&ae(R.$)===!1);L!==void 0&&L.comp.focus()}}return!1})}function w(){i++,m.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function h(t){t!==void 0&&A(t);const r=i+1;k().then(u=>{r===i&&u===!0&&(e.onSubmit!==void 0?n("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function c(t){t!==void 0&&A(t),n("reset"),ne(()=>{w(),e.autofocus===!0&&e.noResetFocus!==!0&&v()})}function v(){oe(()=>{if(l.value===null)return;const t=l.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||l.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||l.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(l.value.querySelectorAll("[tabindex]"),r=>r.tabIndex!==-1);t?.focus({preventScroll:!0})})}Y(se,{bindComponent(t){m.push(t)},unbindComponent(t){const r=m.indexOf(t);r!==-1&&m.splice(r,1)}});let o=!1;return Z(()=>{o=!0}),ee(()=>{o===!0&&e.autofocus===!0&&v()}),te(()=>{e.autofocus===!0&&v()}),Object.assign(f.proxy,{validate:k,resetValidation:w,submit:h,reset:c,focus:v,getValidationComponents:()=>m}),()=>B("form",{class:"q-form",ref:l,onSubmit:h,onReset:c},W(s.default))}}),Ie=F({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:s}){const n=V(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>B("div",{class:n.value},W(s.default))}}),Qe=F({name:"QItem",props:{...le,...re,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:s,emit:n}){const{proxy:{$q:f}}=z(),l=ie(e,f),{hasLink:i,linkAttrs:m,linkClass:k,linkTag:w,navigateOnClick:h}=ue(),c=E(null),v=E(null),o=V(()=>e.clickable===!0||i.value===!0||e.tag==="label"),t=V(()=>e.disable!==!0&&o.value===!0),r=V(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(l.value===!0?" q-item--dark":"")+(i.value===!0&&e.active===null?k.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(t.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),u=V(()=>e.insetLevel===void 0?null:{["padding"+(f.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function y(a){t.value===!0&&(v.value!==null&&(a.qKeyEvent!==!0&&document.activeElement===c.value?v.value.focus():document.activeElement===v.value&&c.value.focus()),h(a))}function d(a){if(t.value===!0&&H(a,[13,32])===!0){A(a),a.qKeyEvent=!0;const p=new MouseEvent("click",a);p.qKeyEvent=!0,c.value.dispatchEvent(p)}n("keyup",a)}function x(){const a=ce(s.default,[]);return t.value===!0&&a.unshift(B("div",{class:"q-focus-helper",tabindex:-1,ref:v})),a}return()=>{const a={ref:c,class:r.value,style:u.value,role:"listitem",onClick:y,onKeyup:d};return t.value===!0?(a.tabindex=e.tabindex||"0",Object.assign(a,m.value)):o.value===!0&&(a["aria-disabled"]="true"),B(w.value,a,x())}}});function O(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const s=parseInt(e,10);return isNaN(s)?0:s}const Ae=de({name:"close-popup",beforeMount(e,{value:s}){const n={depth:O(s),handler(f){n.depth!==0&&setTimeout(()=>{const l=fe(e);l!==void 0&&me(l,f,n.depth)})},handlerKey(f){H(f,13)===!0&&n.handler(f)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:s,oldValue:n}){s!==n&&(e.__qclosepopup.depth=O(s))},beforeUnmount(e){const s=e.__qclosepopup;e.removeEventListener("click",s.handler),e.removeEventListener("keyup",s.handlerKey),delete e.__qclosepopup}});function Fe(){const{buildTree:e}=ve(),{getStatus:s}=pe(),{storeUrl:n}=ye(he()),{navigate:f}=Ne(),{error:l}=Pe(),{t:i}=$(),m=async(o,t,r,u="")=>{const y={label:o,path:t,content:u,type:r,children:[]};if(await h(o,t,r,u)){l(i("notify.fileExists"));return}(await s()).connected&&n.value&&await D.post("/item",y);const x=await S.treeNode.add(y);return await e(),x},k=async(o,t)=>{if(await S.treeNode.update(o.id,ge(t)),t.type==="directory"){const r=o.path+"/"+o.label,u=t.path+"/"+t.label;await S.treeNode.where("path").startsWith(r).modify(y=>{y.path=y.path.replace(r,u)})}},w=async(o,t,r,u,y)=>{const d=await S.treeNode.get(o);if(d===void 0)return;const x={label:d.label,path:d.path,content:d.content,type:d.type},a={label:t,path:r,content:y,type:u};if(await h(t,r,u,y)){l(i("notify.fileExists"));return}if(c(x,a)){await f("home");return}return(await s()).connected&&n.value&&await D.put("/item",{old_item:x,new_item:a}),await k({...x,id:d.id},{...a,id:d.id}),await e(),o},h=async(o,t,r,u)=>(await S.treeNode.filter(d=>d.label===o&&d.type===r&&d.path===t&&d.content===u).toArray()).length>0,c=(o,t)=>o.label===t.label&&o.type===t.type&&o.path===t.path&&o.content===t.content;return{createNode:m,editNode:w,getFolders:async o=>{const t=JSON.parse(be.getItem("selectedNode")??"null");return(await S.treeNode.where("path").equals(o).filter(u=>u.type==="directory"&&(t===null||u.id!==t.id)).toArray()).map(u=>u.label)},isExists:h,areEqual:c}}const $e={class:"text-h6"},Le={key:0,class:"h-full flex flex-center text-grey-7"},Ue=G({__name:"PathInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=$(),n=J(e,"modelValue"),{getFolders:f}=Fe(),l=E([]),i=E(!1),m=E("slide-left");ke(n,async()=>{l.value=await f(n.value)});const k=()=>{m.value="slide-right",n.value=n.value.split("/").slice(0,-1).join("/")||""},w=c=>{m.value="slide-left",n.value=n.value.replace(/\/?$/,"/")+c},h=async()=>{l.value=await f(n.value),i.value=!0};return(c,v)=>(_(),P(M,null,[g(X,{filled:"",type:"text",modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=o=>n.value=o),label:C(s)("form.path"),onClick:h,readonly:"",hint:""},null,8,["modelValue","label"]),g(Se,{modelValue:i.value,"onUpdate:modelValue":v[1]||(v[1]=o=>i.value=o)},{default:q(()=>[g(we,{class:I([c.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md h-[300px] flex flex-col"])},{default:q(()=>[g(K,{class:I([c.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:q(()=>[T("div",$e,Q(C(s)("form.path")),1),T("div",null,[n.value!==""?(_(),N(j,{key:0,flat:"",color:c.$q.dark.isActive?"primary":"white",label:C(s)("button.back"),onClick:k},null,8,["color","label"])):xe("",!0),U(g(j,{flat:"",color:c.$q.dark.isActive?"primary":"white",label:C(s)("button.ok")},null,8,["color","label"]),[[Ae]])])]),_:1},8,["class"]),g(K,{class:"p-4 flex-1 overflow-auto"},{default:q(()=>[l.value.length===0?(_(),P("div",Le,Q(C(s)("message.moveHere")),1)):(_(),N(Be,{transition:m.value,"transition-duration":700,key:l.value.length},{default:q(()=>[(_(!0),P(M,null,qe(l.value,o=>U((_(),N(Qe,{key:o,clickable:"",class:I([c.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:t=>w(o)},{default:q(()=>[g(Ce,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),g(Ie,null,{default:q(()=>[Ee(Q(o),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[Ve]])),128))]),_:1},8,["transition"]))]),_:1}),g(_e)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Me=G({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=$(),n=J(e,"modelValue");return(f,l)=>(_(),N(X,{filled:"",clearable:"",type:"text",modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=i=>n.value=i),label:C(s)("form.name"),rules:[i=>i&&i.length>0]},null,8,["modelValue","label","rules"]))}});export{je as Q,Me as _,Ue as a,Fe as u};
