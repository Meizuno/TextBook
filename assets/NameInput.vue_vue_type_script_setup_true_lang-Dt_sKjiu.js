import{c as F,r as w,p as Z,B as ee,C as te,o as ae,h as B,b as W,g as z,as as ne,x as A,e as le,at as oe,au as se,a as S,K as re,av as ue,L as ie,aw as ce,u as H,m as de,a6 as fe,ax as me,ay as ve,ak as pe,az as he,_ as be,aA as ye,aB as R,aC as _,aD as D,P as ge,N as G,ar as J,w as ke,O as k,S as P,T as p,X as q,al as X,U as g,aE as xe,aF as I,aG as K,V as T,W as Q,a0 as V,Y as j,a4 as qe,s as O,an as U,ao as we,aH as _e,aI as Se,Q as Ce,a1 as Ee,R as Ve}from"./index-BMxCNfhY.js";import{Q as Be}from"./QIntersection-DOX654iP.js";import{u as Y}from"./vue-i18n-CNk1ZW1T.js";const De=F({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:o}){const c=z(),u=w(null);let i=0;const f=[];function h(a){const d=typeof a=="boolean"?a:e.noErrorFocus!==!0,x=++i,C=(l,m)=>{o(`validation${l===!0?"Success":"Error"}`,m)},E=l=>{const m=l.validate();return typeof m.then=="function"?m.then(v=>({valid:v,comp:l}),v=>({valid:!1,comp:l,err:v})):Promise.resolve({valid:m,comp:l})};return(e.greedy===!0?Promise.all(f.map(E)).then(l=>l.filter(m=>m.valid!==!0)):f.reduce((l,m)=>l.then(()=>E(m).then(v=>{if(v.valid===!1)return Promise.reject(v)})),Promise.resolve()).catch(l=>[l])).then(l=>{if(l===void 0||l.length===0)return x===i&&C(!0),!0;if(x===i){const{comp:m,err:v}=l[0];if(v!==void 0&&console.error(v),C(!1,m),d===!0){const L=l.find(({comp:N})=>typeof N.focus=="function"&&ne(N.$)===!1);L!==void 0&&L.comp.focus()}}return!1})}function b(){i++,f.forEach(a=>{typeof a.resetValidation=="function"&&a.resetValidation()})}function y(a){a!==void 0&&A(a);const d=i+1;h().then(x=>{d===i&&x===!0&&(e.onSubmit!==void 0?o("submit",a):a!==void 0&&a.target!==void 0&&typeof a.target.submit=="function"&&a.target.submit())})}function t(a){a!==void 0&&A(a),o("reset"),le(()=>{b(),e.autofocus===!0&&e.noResetFocus!==!0&&n()})}function n(){oe(()=>{if(u.value===null)return;const a=u.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||u.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||u.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(u.value.querySelectorAll("[tabindex]"),d=>d.tabIndex!==-1);a?.focus({preventScroll:!0})})}Z(se,{bindComponent(a){f.push(a)},unbindComponent(a){const d=f.indexOf(a);d!==-1&&f.splice(d,1)}});let r=!1;return ee(()=>{r=!0}),te(()=>{r===!0&&e.autofocus===!0&&n()}),ae(()=>{e.autofocus===!0&&n()}),Object.assign(c.proxy,{validate:h,resetValidation:b,submit:y,reset:t,focus:n,getValidationComponents:()=>f}),()=>B("form",{class:"q-form",ref:u,onSubmit:y,onReset:t},W(s.default))}}),Pe=F({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:s}){const o=S(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>B("div",{class:o.value},W(s.default))}}),Ie=F({name:"QItem",props:{...re,...ue,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:s,emit:o}){const{proxy:{$q:c}}=z(),u=ie(e,c),{hasLink:i,linkAttrs:f,linkClass:h,linkTag:b,navigateOnClick:y}=ce(),t=w(null),n=w(null),r=S(()=>e.clickable===!0||i.value===!0||e.tag==="label"),a=S(()=>e.disable!==!0&&r.value===!0),d=S(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(u.value===!0?" q-item--dark":"")+(i.value===!0&&e.active===null?h.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(a.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),x=S(()=>e.insetLevel===void 0?null:{["padding"+(c.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function C(l){a.value===!0&&(n.value!==null&&(l.qKeyEvent!==!0&&document.activeElement===t.value?n.value.focus():document.activeElement===n.value&&t.value.focus()),y(l))}function E(l){if(a.value===!0&&H(l,[13,32])===!0){A(l),l.qKeyEvent=!0;const m=new MouseEvent("click",l);m.qKeyEvent=!0,t.value.dispatchEvent(m)}o("keyup",l)}function $(){const l=de(s.default,[]);return a.value===!0&&l.unshift(B("div",{class:"q-focus-helper",tabindex:-1,ref:n})),l}return()=>{const l={ref:t,class:d.value,style:x.value,role:"listitem",onClick:C,onKeyup:E};return a.value===!0?(l.tabindex=e.tabindex||"0",Object.assign(l,f.value)):r.value===!0&&(l["aria-disabled"]="true"),B(b.value,l,$())}}});function M(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const s=parseInt(e,10);return isNaN(s)?0:s}const Qe=fe({name:"close-popup",beforeMount(e,{value:s}){const o={depth:M(s),handler(c){o.depth!==0&&setTimeout(()=>{const u=me(e);u!==void 0&&ve(u,c,o.depth)})},handlerKey(c){H(c,13)===!0&&o.handler(c)}};e.__qclosepopup=o,e.addEventListener("click",o.handler),e.addEventListener("keyup",o.handlerKey)},updated(e,{value:s,oldValue:o}){s!==o&&(e.__qclosepopup.depth=M(s))},beforeUnmount(e){const s=e.__qclosepopup;e.removeEventListener("click",s.handler),e.removeEventListener("keyup",s.handlerKey),delete e.__qclosepopup}});function Ae(){const{buildTree:e}=pe(),{getStatus:s}=he(),{storeUrl:o}=be(ye()),c=async t=>{if((await s()).connected&&o.value){const r={label:t.label,path:t.path,content:t.content,type:t.type,children:[]};await R.post("/item",r)}await u(t),await e()},u=async t=>{await _.treeNode.add(D(t))},i=async(t,n)=>{if(await _.treeNode.update(t.id,D(n)),n.type==="directory"){const r=t.path+"/"+t.label,a=n.path+"/"+n.label;await _.treeNode.where("path").startsWith(r).modify(d=>{d.path=d.path.replace(r,a)})}};return{createNode:c,editNode:async(t,n)=>{if((await s()).connected&&o.value){const a={label:t.label,path:t.path,content:t.content,type:t.type,children:[]},d={label:n.label,path:n.path,content:n.content,type:n.type,children:[]};await R.put("/item",{old_item:a,new_item:d})}await i(t,n),await e()},getFolders:async t=>{const n=JSON.parse(ge.getItem("selectedNode")??"null");return(await _.treeNode.where("path").equals(t).filter(a=>a.type==="directory"&&(n===null||a.id!==n.id)).toArray()).map(a=>a.label)},isExists:async t=>(await _.treeNode.filter(r=>r.label===t.label&&r.type===t.type&&r.path===t.path&&r.content===t.content).toArray()).length>0,areEqual:(t,n)=>t.label===n.label&&t.type===n.type&&t.path===n.path&&t.content===n.content}}const Fe={class:"text-h6"},$e={key:0,class:"h-full flex flex-center text-grey-7"},Ke=G({__name:"PathInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=Y(),o=J(e,"modelValue"),{getFolders:c}=Ae(),u=w([]),i=w(!1),f=w("slide-left");ke(o,async()=>{u.value=await c(o.value)});const h=()=>{f.value="slide-right",o.value=o.value.split("/").slice(0,-1).join("/")||""},b=t=>{f.value="slide-left",o.value=o.value.replace(/\/?$/,"/")+t},y=async()=>{u.value=await c(o.value),i.value=!0};return(t,n)=>(k(),P(U,null,[p(X,{filled:"",type:"text",modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=r=>o.value=r),label:q(s)("form.path"),onClick:y,readonly:"",hint:""},null,8,["modelValue","label"]),p(Se,{modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=r=>i.value=r)},{default:g(()=>[p(xe,{class:I([t.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md h-[300px] flex flex-col"])},{default:g(()=>[p(K,{class:I([t.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:g(()=>[T("div",Fe,Q(q(s)("form.path")),1),T("div",null,[o.value!==""?(k(),V(j,{key:0,flat:"",color:t.$q.dark.isActive?"primary":"white",label:q(s)("button.back"),onClick:h},null,8,["color","label"])):qe("",!0),O(p(j,{flat:"",color:t.$q.dark.isActive?"primary":"white",label:q(s)("button.ok")},null,8,["color","label"]),[[Qe]])])]),_:1},8,["class"]),p(K,{class:"p-4 flex-1 overflow-auto"},{default:g(()=>[u.value.length===0?(k(),P("div",$e,Q(q(s)("message.moveHere")),1)):(k(),V(Be,{transition:f.value,"transition-duration":700,key:u.value.length},{default:g(()=>[(k(!0),P(U,null,we(u.value,r=>O((k(),V(Ie,{key:r,clickable:"",class:I([t.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:a=>b(r)},{default:g(()=>[p(Ce,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),p(Pe,null,{default:g(()=>[Ee(Q(r),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[Ve]])),128))]),_:1},8,["transition"]))]),_:1}),p(_e)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Te=G({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=Y(),o=J(e,"modelValue");return(c,u)=>(k(),V(X,{filled:"",clearable:"",type:"text",modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=i=>o.value=i),label:q(s)("form.name"),rules:[i=>i&&i.length>0]},null,8,["modelValue","label","rules"]))}});export{De as Q,Te as _,Ke as a,Ae as u};
