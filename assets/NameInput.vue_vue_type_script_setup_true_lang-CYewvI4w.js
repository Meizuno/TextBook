import{c as $,r as C,p as J,B as Z,C as ee,o as te,h as w,b as O,g as z,as as ae,x as P,e as ne,at as le,au as oe,a as _,K as se,av as ue,L as re,aw as ie,u as W,m as ce,a5 as de,ax as fe,ay as me,al as N,az as D,N as X,aA as ve,ar as Y,w as pe,P as q,S as B,T as b,X as x,am as G,U as k,aB as be,aC as E,aD as R,V as K,W as F,$ as Q,Y as T,a3 as he,s as j,ao as M,ap as ye,aE as ge,aF as ke,Q as qe,a0 as xe,R as _e}from"./index-DX8uY9mq.js";import{u as H}from"./vue-i18n-DJzI2gw9.js";const Qe=$({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:a}){const i=z(),l=C(null);let o=0;const r=[];function m(n){const v=typeof n=="boolean"?n:e.noErrorFocus!==!0,g=++o,S=(t,d)=>{a(`validation${t===!0?"Success":"Error"}`,d)},V=t=>{const d=t.validate();return typeof d.then=="function"?d.then(p=>({valid:p,comp:t}),p=>({valid:!1,comp:t,err:p})):Promise.resolve({valid:d,comp:t})};return(e.greedy===!0?Promise.all(r.map(V)).then(t=>t.filter(d=>d.valid!==!0)):r.reduce((t,d)=>t.then(()=>V(d).then(p=>{if(p.valid===!1)return Promise.reject(p)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return g===o&&S(!0),!0;if(g===o){const{comp:d,err:p}=t[0];if(p!==void 0&&console.error(p),S(!1,d),v===!0){const A=t.find(({comp:L})=>typeof L.focus=="function"&&ae(L.$)===!1);A!==void 0&&A.comp.focus()}}return!1})}function h(){o++,r.forEach(n=>{typeof n.resetValidation=="function"&&n.resetValidation()})}function y(n){n!==void 0&&P(n);const v=o+1;m().then(g=>{v===o&&g===!0&&(e.onSubmit!==void 0?a("submit",n):n!==void 0&&n.target!==void 0&&typeof n.target.submit=="function"&&n.target.submit())})}function u(n){n!==void 0&&P(n),a("reset"),ne(()=>{h(),e.autofocus===!0&&e.noResetFocus!==!0&&c()})}function c(){le(()=>{if(l.value===null)return;const n=l.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||l.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||l.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(l.value.querySelectorAll("[tabindex]"),v=>v.tabIndex!==-1);n?.focus({preventScroll:!0})})}J(oe,{bindComponent(n){r.push(n)},unbindComponent(n){const v=r.indexOf(n);v!==-1&&r.splice(v,1)}});let f=!1;return Z(()=>{f=!0}),ee(()=>{f===!0&&e.autofocus===!0&&c()}),te(()=>{e.autofocus===!0&&c()}),Object.assign(i.proxy,{validate:m,resetValidation:h,submit:y,reset:u,focus:c,getValidationComponents:()=>r}),()=>w("form",{class:"q-form",ref:l,onSubmit:y,onReset:u},O(s.default))}}),Ce=$({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:s}){const a=_(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>w("div",{class:a.value},O(s.default))}}),Se=$({name:"QItem",props:{...se,...ue,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:s,emit:a}){const{proxy:{$q:i}}=z(),l=re(e,i),{hasLink:o,linkAttrs:r,linkClass:m,linkTag:h,navigateOnClick:y}=ie(),u=C(null),c=C(null),f=_(()=>e.clickable===!0||o.value===!0||e.tag==="label"),n=_(()=>e.disable!==!0&&f.value===!0),v=_(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(l.value===!0?" q-item--dark":"")+(o.value===!0&&e.active===null?m.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(n.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),g=_(()=>e.insetLevel===void 0?null:{["padding"+(i.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function S(t){n.value===!0&&(c.value!==null&&(t.qKeyEvent!==!0&&document.activeElement===u.value?c.value.focus():document.activeElement===c.value&&u.value.focus()),y(t))}function V(t){if(n.value===!0&&W(t,[13,32])===!0){P(t),t.qKeyEvent=!0;const d=new MouseEvent("click",t);d.qKeyEvent=!0,u.value.dispatchEvent(d)}a("keyup",t)}function I(){const t=ce(s.default,[]);return n.value===!0&&t.unshift(w("div",{class:"q-focus-helper",tabindex:-1,ref:c})),t}return()=>{const t={ref:u,class:v.value,style:g.value,role:"listitem",onClick:S,onKeyup:V};return n.value===!0?(t.tabindex=e.tabindex||"0",Object.assign(t,r.value)):f.value===!0&&(t["aria-disabled"]="true"),w(h.value,t,I())}}});function U(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const s=parseInt(e,10);return isNaN(s)?0:s}const Ve=de({name:"close-popup",beforeMount(e,{value:s}){const a={depth:U(s),handler(i){a.depth!==0&&setTimeout(()=>{const l=fe(e);l!==void 0&&me(l,i,a.depth)})},handlerKey(i){W(i,13)===!0&&a.handler(i)}};e.__qclosepopup=a,e.addEventListener("click",a.handler),e.addEventListener("keyup",a.handlerKey)},updated(e,{value:s,oldValue:a}){s!==a&&(e.__qclosepopup.depth=U(s))},beforeUnmount(e){const s=e.__qclosepopup;e.removeEventListener("click",s.handler),e.removeEventListener("keyup",s.handlerKey),delete e.__qclosepopup}});function we(){const{setTree:e}=N();return{createNode:async l=>{const o={label:l.label,path:l.path,content:l.content,type:l.type,children:[]};await D.post("/item",o),await e()},editNode:async(l,o)=>{const r={label:l.label,path:l.path,content:l.content,type:l.type,children:[]},m={label:o.label,path:o.path,content:o.content,type:o.type,children:[]};await D.put("/item",{old_item:r,new_item:m}),await e()},getFolders:(l,o)=>{const r=[],m=y=>{for(const u of y)u.path===l&&u.type==="directory"&&u.label!==o&&r.push(u.label),u.children&&m(u.children)},{tree:h}=N();return m(h),r}}}const Be={class:"text-h6"},Ee={key:0,class:"text-center text-grey-7"},$e=X({__name:"PathInput",props:ve({label:{type:String,required:!0}},{modelValue:{type:String,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const{t:s}=H(),a=Y(e,"modelValue"),i=e,{getFolders:l}=we(),o=C(l(a.value,i.label)),r=C(!1);pe(a,()=>{o.value=l(a.value,i.label)});const m=()=>{a.value=a.value.split("/").slice(0,-1).join("/")||"/"},h=u=>{a.value=a.value.replace(/\/?$/,"/")+u},y=()=>{o.value=l(a.value,i.label),r.value=!0};return(u,c)=>(q(),B(M,null,[b(G,{filled:"",type:"text",modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=f=>a.value=f),label:x(s)("form.path"),onClick:y,readonly:"",hint:""},null,8,["modelValue","label"]),b(ke,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=f=>r.value=f)},{default:k(()=>[b(be,{class:E([u.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md"])},{default:k(()=>[b(R,{class:E([u.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:k(()=>[K("div",Be,F(x(s)("form.path")),1),K("div",null,[a.value!=="/"?(q(),Q(T,{key:0,flat:"",color:u.$q.dark.isActive?"primary":"white",label:x(s)("button.back"),onClick:m},null,8,["color","label"])):he("",!0),j(b(T,{flat:"",color:u.$q.dark.isActive?"primary":"white",label:x(s)("button.ok")},null,8,["color","label"]),[[Ve]])])]),_:1},8,["class"]),b(R,{class:"p-4"},{default:k(()=>[o.value.length===0?(q(),B("div",Ee,F(x(s)("message.noFolders")),1)):(q(!0),B(M,{key:1},ye(o.value,f=>j((q(),Q(Se,{key:f,clickable:"",class:E([u.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:n=>h(f)},{default:k(()=>[b(qe,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),b(Ce,null,{default:k(()=>[xe(F(f),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[_e]])),128))]),_:1}),b(ge)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Ie=X({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=H(),a=Y(e,"modelValue");return(i,l)=>(q(),Q(G,{filled:"",clearable:"",type:"text",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value=o),label:x(s)("form.name"),rules:[o=>o&&o.length>0]},null,8,["modelValue","label","rules"]))}});export{Qe as Q,Ie as _,$e as a,we as u};
