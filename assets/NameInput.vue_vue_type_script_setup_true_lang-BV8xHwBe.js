import{c as F,r as w,p as Z,B as ee,C as te,o as ae,h as B,b as W,g as z,as as ne,x as A,e as le,at as oe,au as se,a as S,K as ue,av as re,L as ie,aw as ce,u as H,m as de,a6 as fe,ax as me,ay as ve,ak as pe,az as be,_ as he,aA as ye,aB as R,aC as _,aD as D,P as ge,N as G,ar as J,w as ke,O as k,S as P,T as b,X as q,al as X,U as g,aE as xe,aF as I,aG as K,V as T,W as Q,a0 as E,Y as j,a4 as qe,s as O,an as U,ao as we,aH as _e,aI as Se,Q as Ce,a1 as Ve,R as Ee}from"./index-B1GS6p5i.js";import{Q as Be}from"./QIntersection-BCbHE8ML.js";import{u as Y}from"./vue-i18n-DDXT5T29.js";const De=F({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:n}){const d=z(),r=w(null);let c=0;const f=[];function h(t){const v=typeof t=="boolean"?t:e.noErrorFocus!==!0,x=++c,C=(a,m)=>{n(`validation${a===!0?"Success":"Error"}`,m)},V=a=>{const m=a.validate();return typeof m.then=="function"?m.then(p=>({valid:p,comp:a}),p=>({valid:!1,comp:a,err:p})):Promise.resolve({valid:m,comp:a})};return(e.greedy===!0?Promise.all(f.map(V)).then(a=>a.filter(m=>m.valid!==!0)):f.reduce((a,m)=>a.then(()=>V(m).then(p=>{if(p.valid===!1)return Promise.reject(p)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return x===c&&C(!0),!0;if(x===c){const{comp:m,err:p}=a[0];if(p!==void 0&&console.error(p),C(!1,m),v===!0){const $=a.find(({comp:L})=>typeof L.focus=="function"&&ne(L.$)===!1);$!==void 0&&$.comp.focus()}}return!1})}function y(){c++,f.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function l(t){t!==void 0&&A(t);const v=c+1;h().then(x=>{v===c&&x===!0&&(e.onSubmit!==void 0?n("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function o(t){t!==void 0&&A(t),n("reset"),le(()=>{y(),e.autofocus===!0&&e.noResetFocus!==!0&&u()})}function u(){oe(()=>{if(r.value===null)return;const t=r.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||r.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||r.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(r.value.querySelectorAll("[tabindex]"),v=>v.tabIndex!==-1);t?.focus({preventScroll:!0})})}Z(se,{bindComponent(t){f.push(t)},unbindComponent(t){const v=f.indexOf(t);v!==-1&&f.splice(v,1)}});let i=!1;return ee(()=>{i=!0}),te(()=>{i===!0&&e.autofocus===!0&&u()}),ae(()=>{e.autofocus===!0&&u()}),Object.assign(d.proxy,{validate:h,resetValidation:y,submit:l,reset:o,focus:u,getValidationComponents:()=>f}),()=>B("form",{class:"q-form",ref:r,onSubmit:l,onReset:o},W(s.default))}}),Pe=F({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:s}){const n=S(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>B("div",{class:n.value},W(s.default))}}),Ie=F({name:"QItem",props:{...ue,...re,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:s,emit:n}){const{proxy:{$q:d}}=z(),r=ie(e,d),{hasLink:c,linkAttrs:f,linkClass:h,linkTag:y,navigateOnClick:l}=ce(),o=w(null),u=w(null),i=S(()=>e.clickable===!0||c.value===!0||e.tag==="label"),t=S(()=>e.disable!==!0&&i.value===!0),v=S(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(r.value===!0?" q-item--dark":"")+(c.value===!0&&e.active===null?h.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(t.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),x=S(()=>e.insetLevel===void 0?null:{["padding"+(d.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function C(a){t.value===!0&&(u.value!==null&&(a.qKeyEvent!==!0&&document.activeElement===o.value?u.value.focus():document.activeElement===u.value&&o.value.focus()),l(a))}function V(a){if(t.value===!0&&H(a,[13,32])===!0){A(a),a.qKeyEvent=!0;const m=new MouseEvent("click",a);m.qKeyEvent=!0,o.value.dispatchEvent(m)}n("keyup",a)}function N(){const a=de(s.default,[]);return t.value===!0&&a.unshift(B("div",{class:"q-focus-helper",tabindex:-1,ref:u})),a}return()=>{const a={ref:o,class:v.value,style:x.value,role:"listitem",onClick:C,onKeyup:V};return t.value===!0?(a.tabindex=e.tabindex||"0",Object.assign(a,f.value)):i.value===!0&&(a["aria-disabled"]="true"),B(y.value,a,N())}}});function M(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const s=parseInt(e,10);return isNaN(s)?0:s}const Qe=fe({name:"close-popup",beforeMount(e,{value:s}){const n={depth:M(s),handler(d){n.depth!==0&&setTimeout(()=>{const r=me(e);r!==void 0&&ve(r,d,n.depth)})},handlerKey(d){H(d,13)===!0&&n.handler(d)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:s,oldValue:n}){s!==n&&(e.__qclosepopup.depth=M(s))},beforeUnmount(e){const s=e.__qclosepopup;e.removeEventListener("click",s.handler),e.removeEventListener("keyup",s.handlerKey),delete e.__qclosepopup}});function Ae(){const{buildTree:e}=pe(),{getStatus:s}=be(),{storeUrl:n}=he(ye()),d=async l=>{if((await s()).connected&&n.value){const u={label:l.label,path:l.path,content:l.content,type:l.type,children:[]};await R.post("/item",u)}await r(l),await e()},r=async l=>{await _.treeNode.add(D(l))},c=async(l,o)=>{await _.treeNode.update(l.id,D(o));const u=l.path+"/"+l.label,i=o.path+"/"+o.label;await _.treeNode.where("path").startsWith(u).modify(t=>{t.path=t.path.replace(u,i)})};return{createNode:d,editNode:async(l,o)=>{if((await s()).connected&&n.value){const i={label:l.label,path:l.path,content:l.content,type:l.type,children:[]},t={label:o.label,path:o.path,content:o.content,type:o.type,children:[]};await R.put("/item",{old_item:i,new_item:t})}await c(l,o),await e()},getFolders:async l=>{const o=JSON.parse(ge.getItem("selectedNode")??"null");return(await _.treeNode.where("path").equals(l).filter(i=>i.type==="directory"&&(o===null||i.label!==o.label)).toArray()).map(i=>i.label)},isExists:async l=>(await _.treeNode.filter(u=>u.label===l.label&&u.type===l.type&&u.path!==l.path).toArray()).length>0}}const Fe={class:"text-h6"},Ne={key:0,class:"h-full flex flex-center text-grey-7"},Ke=G({__name:"PathInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=Y(),n=J(e,"modelValue"),{getFolders:d}=Ae(),r=w([]),c=w(!1),f=w("slide-left");ke(n,async()=>{r.value=await d(n.value)});const h=()=>{f.value="slide-right",n.value=n.value.split("/").slice(0,-1).join("/")||""},y=o=>{f.value="slide-left",n.value=n.value.replace(/\/?$/,"/")+o},l=async()=>{r.value=await d(n.value),c.value=!0};return(o,u)=>(k(),P(U,null,[b(X,{filled:"",type:"text",modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=i=>n.value=i),label:q(s)("form.path"),onClick:l,readonly:"",hint:""},null,8,["modelValue","label"]),b(Se,{modelValue:c.value,"onUpdate:modelValue":u[1]||(u[1]=i=>c.value=i)},{default:g(()=>[b(xe,{class:I([o.$q.dark.isActive?"bg-dark text-white":"bg-white text-dark","w-80 shadow-lg rounded-md h-[300px] flex flex-col"])},{default:g(()=>[b(K,{class:I([o.$q.dark.isActive?"bg-grey-9 text-white":"bg-primary text-white","flex justify-between"])},{default:g(()=>[T("div",Fe,Q(q(s)("form.path")),1),T("div",null,[n.value!==""?(k(),E(j,{key:0,flat:"",color:o.$q.dark.isActive?"primary":"white",label:q(s)("button.back"),onClick:h},null,8,["color","label"])):qe("",!0),O(b(j,{flat:"",color:o.$q.dark.isActive?"primary":"white",label:q(s)("button.ok")},null,8,["color","label"]),[[Qe]])])]),_:1},8,["class"]),b(K,{class:"p-4 flex-1 overflow-auto"},{default:g(()=>[r.value.length===0?(k(),P("div",Ne,Q(q(s)("message.moveHere")),1)):(k(),E(Be,{transition:f.value,"transition-duration":700,key:r.value.length},{default:g(()=>[(k(!0),P(U,null,we(r.value,i=>O((k(),E(Ie,{key:i,clickable:"",class:I([o.$q.dark.isActive?"hover:bg-grey-7":"hover:bg-grey-2","rounded-md"]),onClick:t=>y(i)},{default:g(()=>[b(Ce,{color:"primary",name:"folder",size:"md",class:"q-mr-sm"}),b(Pe,null,{default:g(()=>[Ve(Q(i),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),[[Ee]])),128))]),_:1},8,["transition"]))]),_:1}),b(_e)]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}}),Te=G({__name:"NameInput",props:{modelValue:{type:String,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{t:s}=Y(),n=J(e,"modelValue");return(d,r)=>(k(),E(X,{filled:"",clearable:"",type:"text",modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=c=>n.value=c),label:q(s)("form.name"),rules:[c=>c&&c.length>0]},null,8,["modelValue","label","rules"]))}});export{De as Q,Te as _,Ke as a,Ae as u};
