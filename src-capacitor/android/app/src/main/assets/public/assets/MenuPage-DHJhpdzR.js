import{c as ae,d as _e,h,V as xe,Z as me,_ as we,r as M,$ as Ce,a as N,w as p,g as Te,e as Se,v as qe,a0 as Ke,Q as L,a1 as Ee,x as ee,s as Ne,a2 as $e,a3 as te,K as Ae,a4 as Fe,M as Be,a5 as ze,a6 as Le,O as U,a7 as Pe,T as $,S as I,a8 as Qe,a9 as Oe,X as ne,P as le,aa as A,ab as ie,ac as O}from"./index-B2sqISku.js";import{u as Me}from"./node-B0XvSiwp.js";import{a as Ve}from"./useNavigation-BWspNTU1.js";import{u as je}from"./useNode-DOyavTh_.js";const He=ae({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(n,{slots:S,emit:b}){let x=!1,w,C,g=null,y=null,o,q;function K(){w&&w(),w=null,x=!1,g!==null&&(clearTimeout(g),g=null),y!==null&&(clearTimeout(y),y=null),C!==void 0&&C.removeEventListener("transitionend",o),o=null}function E(a,v,u){v!==void 0&&(a.style.height=`${v}px`),a.style.transition=`height ${n.duration}ms cubic-bezier(.25, .8, .50, 1)`,x=!0,w=u}function F(a,v){a.style.overflowY=null,a.style.height=null,a.style.transition=null,K(),v!==q&&b(v)}function _(a,v){let u=0;C=a,x===!0?(K(),u=a.offsetHeight===a.scrollHeight?0:void 0):(q="hide",a.style.overflowY="hidden"),E(a,u,v),g=setTimeout(()=>{g=null,a.style.height=`${a.scrollHeight}px`,o=m=>{y=null,(Object(m)!==m||m.target===a)&&F(a,"show")},a.addEventListener("transitionend",o),y=setTimeout(o,n.duration*1.1)},100)}function T(a,v){let u;C=a,x===!0?K():(q="show",a.style.overflowY="hidden",u=a.scrollHeight),E(a,u,v),g=setTimeout(()=>{g=null,a.style.height=0,o=m=>{y=null,(Object(m)!==m||m.target===a)&&F(a,"hide")},a.addEventListener("transitionend",o),y=setTimeout(o,n.duration*1.1)},100)}return _e(()=>{x===!0&&K()}),()=>h(xe,{css:!1,appear:n.appear,onEnter:_,onLeave:T},S.default)}}),De=["none","strict","leaf","leaf-filtered"],Ue=ae({name:"QTree",props:{...me,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:n=>De.includes(n)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:{},noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(n,{slots:S,emit:b}){const{proxy:x}=Te(),{$q:w}=x,C=we(n,w),g=M({}),y=M(n.ticked||[]),o=M(n.expanded||[]);let q={};Ce(()=>{q={}});const K=N(()=>`q-tree q-tree--${n.dense===!0?"dense":"standard"}`+(n.noConnectors===!0?" q-tree--no-connectors":"")+(C.value===!0?" q-tree--dark":"")+(n.color!==void 0?` text-${n.color}`:"")),E=N(()=>n.selected!==void 0),F=N(()=>n.icon||w.iconSet.tree.icon),_=N(()=>n.controlColor||n.color),T=N(()=>n.textColor!==void 0?` text-${n.textColor}`:""),a=N(()=>{const t=n.selectedColor||n.color;return t?` text-${t}`:""}),v=N(()=>n.filterMethod!==void 0?n.filterMethod:(t,l)=>{const e=l.toLowerCase();return t[n.labelKey]&&t[n.labelKey].toLowerCase().indexOf(e)!==-1}),u=N(()=>{const t={},l=(e,r)=>{const i=e.tickStrategy||(r?r.tickStrategy:n.tickStrategy),c=e[n.nodeKey],s=e[n.childrenKey]&&Array.isArray(e[n.childrenKey])&&e[n.childrenKey].length!==0,B=e.disabled!==!0&&E.value===!0&&e.selectable!==!1,k=e.disabled!==!0&&e.expandable!==!1,ge=i!=="none",Q=i==="strict",J=i==="leaf-filtered",H=i==="leaf"||i==="leaf-filtered";let D=e.disabled!==!0&&e.tickable!==!1;H===!0&&D===!0&&r&&r.tickable!==!0&&(D=!1);let z=e.lazy;z===!0&&g.value[c]!==void 0&&Array.isArray(e[n.childrenKey])===!0&&(z=g.value[c]);const d={key:c,parent:r,isParent:s,lazy:z,disabled:e.disabled,link:e.disabled!==!0&&(B===!0||k===!0&&(s===!0||z===!0)),children:[],matchesFilter:n.filter?v.value(e,n.filter):!0,selected:c===n.selected&&B===!0,selectable:B,expanded:s===!0?o.value.includes(c):!1,expandable:k,noTick:e.noTick===!0||Q!==!0&&z&&z!=="loaded",tickable:D,tickStrategy:i,hasTicking:ge,strictTicking:Q,leafFilteredTicking:J,leafTicking:H,ticked:Q===!0?y.value.includes(c):s===!0?!1:y.value.includes(c)};if(t[c]=d,s===!0&&(d.children=e[n.childrenKey].map(f=>l(f,d)),n.filter&&(d.matchesFilter!==!0?d.matchesFilter=d.children.some(f=>f.matchesFilter):d.noTick!==!0&&d.disabled!==!0&&d.tickable===!0&&J===!0&&d.children.every(f=>f.matchesFilter!==!0||f.noTick===!0||f.tickable!==!0)===!0&&(d.tickable=!1)),d.matchesFilter===!0&&(d.noTick!==!0&&Q!==!0&&d.children.every(f=>f.noTick)===!0&&(d.noTick=!0),H))){if(d.ticked=!1,d.indeterminate=d.children.some(f=>f.indeterminate===!0),d.tickable=d.tickable===!0&&d.children.some(f=>f.tickable),d.indeterminate!==!0){const f=d.children.reduce((W,be)=>be.ticked===!0?W+1:W,0);f===d.children.length?d.ticked=!0:f>0&&(d.indeterminate=!0)}d.indeterminate===!0&&(d.indeterminateNextState=d.children.every(f=>f.tickable!==!0||f.ticked!==!0))}return d};return n.nodes.forEach(e=>l(e,null)),t});p(()=>n.ticked,t=>{y.value=t}),p(()=>n.expanded,t=>{o.value=t});function m(t){const l=[].reduce,e=(r,i)=>{if(r||!i)return r;if(Array.isArray(i)===!0)return l.call(Object(i),e,r);if(i[n.nodeKey]===t)return i;if(i[n.childrenKey])return e(null,i[n.childrenKey])};return e(null,n.nodes)}function re(){return y.value.map(t=>m(t))}function de(){return o.value.map(t=>m(t))}function ce(t){return t&&u.value[t]?u.value[t].expanded:!1}function oe(){n.expanded!==void 0?b("update:expanded",[]):o.value=[]}function R(){const t=[],l=e=>{e[n.childrenKey]&&e[n.childrenKey].length!==0&&e.expandable!==!1&&e.disabled!==!0&&(t.push(e[n.nodeKey]),e[n.childrenKey].forEach(l))};n.nodes.forEach(l),n.expanded!==void 0?b("update:expanded",t):o.value=t}function V(t,l,e=m(t),r=u.value[t]){if(r.lazy&&r.lazy!=="loaded"){if(r.lazy==="loading")return;g.value[t]="loading",Array.isArray(e[n.childrenKey])!==!0&&(e[n.childrenKey]=[]),b("lazyLoad",{node:e,key:t,done:i=>{g.value[t]="loaded",e[n.childrenKey]=Array.isArray(i)===!0?i:[],Se(()=>{const c=u.value[t];c&&c.isParent===!0&&Y(t,!0)})},fail:()=>{delete g.value[t],e[n.childrenKey].length===0&&delete e[n.childrenKey]}})}else r.isParent===!0&&r.expandable===!0&&Y(t,l)}function Y(t,l){let e=o.value;const r=n.expanded!==void 0;if(r===!0&&(e=e.slice()),l){if(n.accordion&&u.value[t]){const i=[];u.value[t].parent?u.value[t].parent.children.forEach(c=>{c.key!==t&&c.expandable===!0&&i.push(c.key)}):n.nodes.forEach(c=>{const s=c[n.nodeKey];s!==t&&i.push(s)}),i.length!==0&&(e=e.filter(c=>i.includes(c)===!1))}e=e.concat([t]).filter((i,c,s)=>s.indexOf(i)===c)}else e=e.filter(i=>i!==t);r===!0?b("update:expanded",e):o.value=e}function se(t){return t&&u.value[t]?u.value[t].ticked:!1}function P(t,l){let e=y.value;const r=n.ticked!==void 0;r===!0&&(e=e.slice()),l?e=e.concat(t).filter((i,c,s)=>s.indexOf(i)===c):e=e.filter(i=>t.includes(i)===!1),r===!0&&b("update:ticked",e)}function ue(t,l,e){const r={tree:x,node:t,key:e,color:n.color,dark:C.value};return te(r,"expanded",()=>l.expanded,i=>{i!==l.expanded&&V(e,i)}),te(r,"ticked",()=>l.ticked,i=>{i!==l.ticked&&P([e],i)}),r}function X(t){return(n.filter?t.filter(l=>u.value[l[n.nodeKey]].matchesFilter):t).map(l=>ve(l))}function fe(t){if(t.icon!==void 0)return h(L,{class:"q-tree__icon q-mr-sm",name:t.icon,color:t.iconColor});const l=t.img||t.avatar;if(l)return h("img",{class:`q-tree__${t.img?"img":"avatar"} q-mr-sm`,src:l})}function he(){b("afterShow")}function ye(){b("afterHide")}function ve(t){const l=t[n.nodeKey],e=u.value[l],r=t.header&&S[`header-${t.header}`]||S["default-header"],i=e.isParent===!0?X(t[n.childrenKey]):[],c=i.length!==0||e.lazy&&e.lazy!=="loaded";let s=t.body&&S[`body-${t.body}`]||S["default-body"];const B=r!==void 0||s!==void 0?ue(t,e,l):null;return s!==void 0&&(s=h("div",{class:"q-tree__node-body relative-position"},[h("div",{class:T.value},[s(B)])])),h("div",{key:l,class:`q-tree__node relative-position q-tree__node--${c===!0?"parent":"child"}`},[h("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(e.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(e.selected===!0?" q-tree__node--selected":"")+(e.disabled===!0?" q-tree__node--disabled":""),tabindex:e.link===!0?0:-1,ariaExpanded:i.length>0?e.expanded:null,role:"treeitem",onClick:k=>{G(t,e,k)},onKeypress(k){qe(k)!==!0&&(k.keyCode===13?G(t,e,k,!0):k.keyCode===32&&j(t,e,k,!0))}},[h("div",{class:"q-focus-helper",tabindex:-1,ref:k=>{q[e.key]=k}}),e.lazy==="loading"?h(Ke,{class:"q-tree__spinner",color:_.value}):c===!0?h(L,{class:"q-tree__arrow"+(e.expanded===!0?" q-tree__arrow--rotate":""),name:F.value,onClick(k){j(t,e,k)}}):null,e.hasTicking===!0&&e.noTick!==!0?h(Ee,{class:"q-tree__tickbox",modelValue:e.indeterminate===!0?null:e.ticked,color:_.value,dark:C.value,dense:!0,keepColor:!0,disable:e.tickable!==!0,onKeydown:ee,"onUpdate:modelValue":k=>{ke(e,k)}}):null,h("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(e.selected===!0?a.value:T.value)},[r?r(B):[fe(t),h("div",t[n.labelKey])]])]),c===!0?n.noTransition===!0?e.expanded===!0?h("div",{class:"q-tree__node-collapsible"+T.value,key:`${l}__q`},[s,h("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},i)]):null:h(He,{duration:n.duration,onShow:he,onHide:ye},()=>Ne(h("div",{class:"q-tree__node-collapsible"+T.value,key:`${l}__q`},[s,h("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},i)]),[[$e,e.expanded]])):s])}function Z(t){const l=q[t];l&&l.focus()}function G(t,l,e,r){r!==!0&&l.selectable!==!1&&Z(l.key),E.value&&l.selectable?n.noSelectionUnset===!1?b("update:selected",l.key!==n.selected?l.key:null):l.key!==n.selected&&b("update:selected",l.key===void 0?null:l.key):j(t,l,e,r),typeof t.handler=="function"&&t.handler(t)}function j(t,l,e,r){e!==void 0&&ee(e),r!==!0&&l.selectable!==!1&&Z(l.key),V(l.key,!l.expanded,t,l)}function ke(t,l){if(t.indeterminate===!0&&(l=t.indeterminateNextState),t.strictTicking)P([t.key],l);else if(t.leafTicking){const e=[],r=i=>{i.isParent?(l!==!0&&i.noTick!==!0&&i.tickable===!0&&e.push(i.key),i.leafTicking===!0&&i.children.forEach(r)):i.noTick!==!0&&i.tickable===!0&&(i.leafFilteredTicking!==!0||i.matchesFilter===!0)&&e.push(i.key)};r(t),P(e,l)}}return n.defaultExpandAll===!0&&R(),Object.assign(x,{getNodeByKey:m,getTickedNodes:re,getExpandedNodes:de,isExpanded:ce,collapseAll:oe,expandAll:R,setExpanded:V,isTicked:se,setTicked:P}),()=>{const t=X(n.nodes);return h("div",{class:K.value,role:"tree"},t.length===0?n.filter?n.noResultsLabel||w.lang.tree.noResults:n.noNodesLabel||w.lang.tree.noNodes:t)}}}),Ie={class:"q-pa-md"},Re={class:"row no-wrap justify-between full-width"},Ye={class:"row no-wrap ellipsis line items-center full-width"},Xe={class:"full-width"},Ze={class:"row no-wrap"},Ge={class:"row no-wrap justify-between gap-2 full-width"},Je=["onClick"],We={class:"flex-1"},pe={class:"row no-wrap"},it=Ae({__name:"MenuPage",setup(n){const S=Fe(),{setActiveNode:b,setSelectedNode:x}=Me(),{deleteNode:w}=je(),{tree:C}=Be(ze()),{error:g}=Le(),{navigate:y}=Ve(),o=M(""),q=async _=>{b(_),await y("active")},K=async _=>{x(_),await y("folder")},E=_=>{S.dialog({title:"Confirm",message:"Are you sure you want to delete",cancel:!0,persistent:!0}).onOk(()=>{w(_).catch(()=>{g("Failed to delete")})})},F=async _=>{x(_),await y("file")};return(_,T)=>(U(),Pe("div",Ie,[$(Qe,{dense:"",filled:"",modelValue:o.value,"onUpdate:modelValue":T[1]||(T[1]=a=>o.value=a),label:"Search",class:"q-my-md"},{append:I(()=>[o.value===""?(U(),le(L,{key:0,name:"search"})):(U(),le(L,{key:1,name:"clear",class:"cursor-pointer",onClick:T[0]||(T[0]=a=>o.value="")}))]),_:1},8,["modelValue"]),$(Ue,Oe({class:{"text-center":ne(C).length===0}},{"no-nodes-label":"No files found",class:"text-body1",nodes:ne(C),"node-key":"key",filter:o.value}),{"header-folder":I(a=>[A("div",Re,[A("div",Ye,[$(L,{class:"q-mr-sm text-blue-8",name:a.node.icon},null,8,["name"]),A("div",Xe,ie(a.node.label.split(".")[0]),1)]),A("div",Ze,[$(O,{flat:"",dense:"",color:"primary",icon:"edit",onClick:v=>K(a.node)},null,8,["onClick"]),$(O,{flat:"",dense:"",color:"negative",icon:"delete",onClick:v=>E(a.node)},null,8,["onClick"])])])]),"header-file":I(a=>[A("div",Ge,[A("div",{class:"row no-wrap ellipsis items-center full-width",onClick:v=>q(a.node)},[$(L,{size:"20px",class:"q-mr-xs text-blue-8",name:a.node.icon},null,8,["name"]),A("div",We,ie(a.node.label.split(".")[0]),1)],8,Je),A("div",pe,[$(O,{flat:"",dense:"",color:"primary",icon:"edit",onClick:v=>F(a.node)},null,8,["onClick"]),$(O,{flat:"",dense:"",color:"negative",icon:"delete",onClick:v=>E(a.node)},null,8,["onClick"])])])]),_:1},16,["nodes","filter"])]))}});export{it as default};
